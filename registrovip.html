<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Crear cuenta</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#720e9e">
<link rel="icon" type="image/png" href="imagen/app_icon_xxxhdpi.png">

<!-- FIREBASE v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(120deg,#22d3ee,#6366f1,#ec4899);
  background-size:300% 300%;
  animation:bg 16s infinite;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.card{
  width:100%;
  max-width:380px;
  background:#fff;
  padding:28px;
  border-radius:20px;
  box-shadow:0 40px 80px rgba(0,0,0,.3);
}
.step{display:none}
.step.active{display:block}
h1{margin:0 0 6px;font-size:22px;font-weight:800}
.sub{font-size:13px;color:#475569;margin-bottom:18px}
input{
  width:100%;
  padding:14px;
  margin-bottom:14px;
  border-radius:12px;
  border:1px solid #cbd5f5;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#6366f1,#ec4899);
  color:#fff;
  font-weight:800;
  cursor:pointer;
}
.msg{font-size:13px;color:#dc2626}
.watermark{text-align:center;font-size:11px;color:#64748b;margin-top:12px}

/* MODAL */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
#modal-content{
  background:#fff;
  width:90%;
  max-width:360px;
  padding:20px;
  border-radius:16px;
  text-align:center;
}
iframe{
  width:100%;
  height:200px;
  border-radius:12px;
  margin:12px 0;
}
</style>
</head>

<body>

<div class="card">

  <div class="step active" id="step1">
    <h1>Crear cuenta</h1>
    <div class="sub">Correo y contrase√±a</div>
    <input id="correo" type="email" placeholder="Correo">
    <input id="clave" type="password" placeholder="Contrase√±a">
    <button onclick="nextStep(1)">Continuar</button>
    <div class="msg" id="msg1"></div>
  </div>

  <div class="step" id="step2">
    <h1>Usuario</h1>
    <div class="sub">Configura tu cuenta</div>
    <input id="usuario" placeholder="nombre">
    <input id="clave2" type="password" placeholder="Confirmar contrase√±a">
    <button onclick="nextStep(2)">Continuar</button>
    <div class="msg" id="msg2"></div>
  </div>

  <div class="step" id="step3">
    <h1>Seguridad</h1>
    <div class="sub">Monto y PIN</div>
    <input id="monto" type="number" placeholder="Monto">
    <input id="pin" maxlength="6" placeholder="PIN 6 d√≠gitos">
    <button onclick="registrarUsuario()">Crear cuenta</button>
  </div>

  <div class="watermark">Desarrollador: <b>KTT</b></div>
</div>

<div id="modal">
  <div id="modal-content"></div>
</div>

<script>
// üî• FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyBHbUTYykUxlJWl6QF6L9YwhC5kNFKpwV0",
  authDomain: "apps-d075e.firebaseapp.com",
  projectId: "apps-d075e"
});
const auth = firebase.auth();
const db = firebase.firestore();

const modal = document.getElementById("modal");
const modalContent = document.getElementById("modal-content");

const correo = document.getElementById("correo");
const clave = document.getElementById("clave");
const clave2 = document.getElementById("clave2");
const usuario = document.getElementById("usuario");
const monto = document.getElementById("monto");
const pin = document.getElementById("pin");

function nextStep(step){
  document.getElementById("step"+step).classList.remove("active");
  document.getElementById("step"+(step+1)).classList.add("active");
}

function registrarUsuario(){
  modal.style.display="flex";
  modalContent.innerHTML="‚è≥ Registrando...";

  auth.createUserWithEmailAndPassword(correo.value, clave.value)
    .then(res=>{
      return db.collection("usuarios").doc(res.user.uid).set({
        nombre: usuario.value,
        correo: correo.value,
        monto: monto.value,
        pin: pin.value
      });
    })
    .then(()=>{
      modalContent.innerHTML = `
        <h3>üéâ Cuenta creada con √©xito</h3>
        <p style="font-size:13px;color:#475569">
          Para ver el funcionamiento del sistema,
          mira el siguiente video.<br>
          Cuando termines, pulsa <b>Continuar</b>.
        </p>

        <!-- VIDEO -->
        <iframe 
          src="https://youtu.be/Qs1d2KJ0Maw?si=YX4ApkCuRxR_agP5"
          allowfullscreen>
        </iframe>

        <button onclick="continuar()" style="
          background:#22c55e;
          margin-top:10px">
          ‚úÖ Continuar
        </button>
      `;
    })
    .catch(e=>{
      modalContent.innerHTML="‚ùå "+e.message;
    });
}

function continuar(){
  window.location.href="/";
}
</script>

</body>
</html>
